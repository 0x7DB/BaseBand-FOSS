package dev.jess.baseband.client.impl.Modules.Exploits;

import dev.jess.baseband.client.api.Main.BaseBand;
import dev.jess.baseband.client.api.Module.Category;
import dev.jess.baseband.client.api.Module.Module;
import dev.jess.baseband.client.api.Settings.Setting;
import net.minecraft.entity.Entity;
import net.minecraft.entity.player.EntityPlayer;

import java.awt.*;

public class TickShift extends Module {

	private final Setting ticksVal = new Setting("Ticks", this, 15, 1, 40, true);
	private final Setting timer = new Setting("Timer", this, 1.8, 1, 3, false);
	boolean canTimer = false;
	int tick = 0;

	public TickShift() {
		super("TickShift", "Simples...", Category.EXPLOITS, new Color(232, 122, 122, 255).getRGB());
		BaseBand.settingsManager.rSetting(ticksVal);
		BaseBand.settingsManager.rSetting(timer);
	}


	public static boolean isEntityMoving(Entity entity) {
		if (entity == null) {
			return false;
		}
		if (entity instanceof EntityPlayer) {
			return mc.gameSettings.keyBindForward.isKeyDown() || mc.gameSettings.keyBindBack.isKeyDown() || mc.gameSettings.keyBindLeft.isKeyDown() || mc.gameSettings.keyBindRight.isKeyDown();
		}
		return entity.motionX != 0.0 || entity.motionY != 0.0 || entity.motionZ != 0.0;
	}

	public void disable() {
		mc.timer.tickLength = 50f;
	}

	public void enable() {
		canTimer = false;
		tick = 0;
	}

	public void tick() {
		this.setMcHudMeta(String.valueOf(tick));
		if (tick <= 0) {
			tick = 0;
			canTimer = false;
			mc.timer.tickLength = 50f;
		}

		if (tick > 0 && isEntityMoving(mc.player)) {
			tick--;
			mc.timer.tickLength = (50f / (float) timer.getValDouble());
			//ticksPassed++;
		}

		if (! isEntityMoving(mc.player)) {
			mc.timer.tickLength = 50f;
			tick++;
		}

		if (tick >= ticksVal.getValDouble()) {
			mc.timer.tickLength = 50f;
			tick = (int) ticksVal.getValDouble();
		}
	}


}
