package dev.jess.baseband.client.impl.Modules.Exploits;

import com.mojang.realmsclient.gui.ChatFormatting;
import dev.jess.baseband.client.api.Module.Category;
import dev.jess.baseband.client.api.Module.Module;
import dev.jess.baseband.client.api.Utils.ChatUtil;
import net.minecraft.entity.Entity;
import net.minecraft.entity.player.EntityPlayer;
import net.minecraft.network.Packet;
import net.minecraft.network.play.server.SPacketEntityTeleport;

import java.awt.*;

public class TraceTeleport extends Module {
	public TraceTeleport() {
		super("TraceTeleport", "Cover-up for NoCom.", Category.EXPLOITS, new Color(10, 232, 242, 255).getRGB());
	}


	public boolean onPacketReceive(Packet<?> packet) {

		if (packet != null && packet.getClass() == SPacketEntityTeleport.class) {
			SPacketEntityTeleport packet2 = (SPacketEntityTeleport) packet;

			if (! (mc.world.getEntityByID(packet2.getEntityId()) instanceof EntityPlayer)) return false;
			if (Math.abs(mc.player.posX - packet2.getX()) > 50d || Math.abs(mc.player.posZ - packet2.getZ()) > 50d) {
				String name = "Unknown";
				Entity entity = mc.world.getEntityByID(packet2.getEntityId());
				if (entity != null) name = entity.getClass().getSimpleName();

				double distance = Math.sqrt(Math.pow(mc.player.posX - packet2.getX(), 2d) + Math.pow(mc.player.posZ - packet2.getZ(), 2d));

				String warn = String.format("Entity [%s] teleported to [%.2f, %.2f, %.2f], %.2f blocks away", name, packet2.getX(), packet2.getY(), packet2.getZ(), distance);

				ChatUtil.sendChatMsg(ChatFormatting.GREEN + warn);
			}
		}

		return false;
	}
}
